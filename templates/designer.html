{% extends "_base.html" %}
{% block title %}Designer{% endblock %}
{% block body %}
  {% raw %}

<div ng-controller='DesignerCtrl' id="full-page">
  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <div class="logo-box">
          <span>CRISPR Library Designer</span>
        </div>
        <div class="search-box form-group"> 
          <div class="input-group">
            <input type="text" class="form-control" id="search-str" placeholder="Search for additional genes or tissues...">
            <div class="input-group-addon"><i class="fa fa-search"></i></div>
          </div>
        </div>
        <div class="guide-count-box">
          <button type="button" class="btn btn-primary" ng-csv="getGuidesCSV()" filename="guides.csv" csv-header="['Seq',  'Start',   'Score', 'Gene', 'Exon']" csv-column-order="['seq', 'start', 'score', 'gene', 'exon']"> Export {{ countSelectedGuides }} guides</button>
        </div>
      </div>
    </div>
  </div>
  <div id="wrapper">
    <div id="sidebar-wrapper">
      <div class="sidebar-wrapper-inner">
        <ul class="sidebar-nav">
          <li ng-repeat="thegene in gene_to_exon" class="sidebar-primary-item-action" ng-class="{ selected_item : thegene == gene }">
            <a href="" ng-click="setGene($index)" class="sidebar-primary-item-action" ng-class="{ selected_item : thegene == gene }">
              <span class="sidebar-primary-item-action">
                <i class="glyphicon glyph-science-atom"></i> {{ thegene.name }}
              </span>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div id="page-content-wrapper">
      <div class="page-content">
        <div class="container-fluid" id='container'>
          <div class="row">
            <div class="col-md-12">
              <svg height="250" id="exon_graph" width="100%" x="20">
                <g id="background_exon_graph">
                  <rect fill="#eee" height="250" width="100%" x="0" y="0"></rect>
                </g>
                <g id="all_exons">
                  <rect class="connector" fill="#000" height="3" stroke="#000" width="100%" x="0" y="100" id="connector_rect"></rect>

                  <g ng-repeat="exon in gene.exons">
                    <rect class="exon" fill="#fff" height="50" ng-attr-width="{{2 * svgUnit()}}" stroke="#aaa" ng-attr-x="{{ svgUnit() + $index*3*svgUnit() }}" y="75"></rect>

                    <text class="gRNA_count" fill="#111" font-size="16" ng-attr-x="{{svgUnit()*1.8  + $index*3*svgUnit() }}" y="108">
                      {{ (exon.gRNAs | filter:{selected:true}).length }}
                    </text>

                    <text class="exon_label" fill="#111" font-size="8" ng-attr-x="{{svgUnit()*1.6  + $index*3*svgUnit() }}" y="145">
                      Exon {{ $index + 1 }}
                    </text>
                  </g>
                </g>
              </svg>






<!--                   <rect class="connector" fill="#000000" height="3" stroke="#000000" width="800" x="0" y="50">< /  rect>
                  <g ng-repeat = "exon in gene.exons">
                    <rect class="exon" fill="#ffffff" height="50" stroke="#aaa" ng-attr-width="{{ exon.p_end-exon .  p_start }}" ng-attr-x="{{ exon.p_start }}" y="25"></rect>
                    <text class="exon_label" fill="#111" font-size="12" ng-attr-x="{{ exon.p_start+1 }}" y="90">
                      Exon {{ $index + 1 }}
                    </text>
                    <text class="gRNA_count" fill="#111" font-size="16" ng-attr-x="{{ exon.p_start + (exon.p_end  -  exon.p_start) / 2 }}" y="55">
                      {{ exon.gRNAs.length }}
                    </text>
                    <g ng-repeat="guide in exon.gRNAs | filter:{selected:true}">
                      <rect class="guide" fill="#222" height="4" width="20" ng-attr-x="{{ exon.p_start + guide.   p_start }}" y="25">
                    </g>
                  </g>
                </g>
              </svg> -->

            </div>
          </div>
          <div class="row">
            <div class=".col-md-6 .col-md-offset-3">
              <div class="table-header">
                <span>
                  Choose your guides below...or keep what what our algorithms have chosen!
                </span>
              </div>
              <table class="table">
                <tr>
                  <th></th>
                  <th>Sequence</th>
                  <th>Start</th>
                  <th>Score</th>
                  <th>Exon</th>
                </tr>
                <tr ng-repeat="guide in all_gRNAs[gene.name] | orderBy:'-score'">
                  <td><input type="checkbox" ng-model="guide.selected" ng-change="guideSelected(guide)"></td>
                  <td>{{ guide.seq }}</td>
                  <td>{{ guide.start }}</td>
                  <td>{{ guide.score.toFixed(2) }}</td>
                  <td>{{ guide.exon }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  {% endraw %}
{% endblock %}
