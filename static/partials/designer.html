<div ng-if="guidesReady == false" style="background:url('static/img/double-helix-spin.gif');background-position:50% 50%;background-repeat:no-repeat;width:100%;height:100%;position:absolute">

   <div style="text-align:center;font-size:26px;position:absolute;top:45%;width:100%;text-shadow:1px 1px 2px white, -1px -1px 2px white,-4px 4px 4px white,-4px 4px 4px white">
    Step 2) Designing your library...
    <div class="library-summary">Imported {{gene_statistics.actual}} of {{gene_statistics.expected}} genes.</div>

   </div>

</div>
<div id="full-page" ng-if="guidesReady">
  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <div class="logo-box">
          <a href="/#/"><span>CRISPR Library Designer</span></a>
        </div>
        <div class="search-box form-group"> 
          <div class="input-group">
            <input type="text" class="form-control" id="search-str" placeholder="Search for additional genes or tissues..." ng-model="geneTissueQuery">
            <div class="input-group-addon" ng-click="geneTissueSearch()"><i class="fa fa-search"></i></div>
          </div>
        </div>
        <div class="guide-count-box">
          <span>
            Guides in Library: {{ countSelectedGuides }}
          </span>
          <button type="button" class="btn btn-primary" ng-csv="getGuidesCSV()" filename="guides.csv" csv-header="['Seq',  'Start',   'Score', 'Gene', 'Exon']" csv-column-order="['seq', 'start', 'score', 'gene', 'exon']"> Export Library (.csv)</button>
        </div>
      </div>
    </div>
  </div>
  <div id="wrapper">
    <div id="sidebar-wrapper">
      <div class="sidebar-wrapper-inner">
        <ul class="sidebar-nav">
          <li class="sidebar-header sidebar-header-first" ng-if="guidesReady">Genes</li>
          <li ng-repeat="thegene in gene_to_exon" class="sidebar-primary-item-action" ng-class="{ selected_item : thegene == gene }">
            <span class="sidebar-primary-item-action">
              <div class="x-close-container">
                <span ng-click="removeGene($index)" class="x-close"><i class="fa fa-times-circle"></i></span>
              </div>
              <div class="sidebar-primary-item-action-text-container">
                <a href="" ng-click="setGene($index)" class="sidebar-primary-item-action" ng-class="{ selected_item : thegene == gene }">
                  <span class="sidebar-primary-item-action-text">
   {{ thegene.name }} <span class="boxed">{{ selectedGuides(thegene.name).length }} guides</span>
                  </span>
                </a>
              </div>
            </span>
          </li>
          <hr class="gene-tissue-seperator" ng-if="tissues_enabled && guidesReady">
          <li class="sidebar-header" ng-if="tissues_enabled && guidesReady">Tissues</li>
          <li ng-repeat="thetissue in tissues" class="sidebar-primary-item-action" ng-if="tissues_enabled && guidesReady">
            <span class="sidebar-primary-item-action">
              <div class="x-close-container">
                <span ng-click="removeTissue($index)" class="x-close"><i class="fa fa-times-circle"></i></span>
              </div>
              <div class="sidebar-primary-item-action-text-container">
                <a href="" class="sidebar-primary-item-action sidebar-noclick">
                  <span class="sidebar-primary-item-action-text">
   {{ thetissue }}
                  </span>
                </a>
              </div>
            </span>
          </li>
          <hr class="gene-tissue-seperator" ng-if="guidesReady">
          <li class="sidebar-header" ng-if="guidesReady">Actions</li>
          <li class="sidebar-primary-item-action" ng-if="guidesReady">
            <span class="sidebar-primary-item-action">
              <div class="x-close-container">
                <span class="x-close"><i class="fa fa-repeat"></i></span>
              </div>
              <div class="sidebar-primary-item-action-text-container">
                <a href="/#/" class="sidebar-primary-item-action">
                  <span class="sidebar-primary-item-action-text">
   Start Over
                  </span>
                </a>
              </div>
            </span>
          </li>
          <li class="sidebar-primary-item-action" ng-if="guidesReady">
            <span class="sidebar-primary-item-action">
              <div class="x-close-container">
                <span class="x-close"><i class="fa fa-download"></i></span>
              </div>
              <div class="sidebar-primary-item-action-text-container">
                <a class="sidebar-primary-item-action" ng-csv="getGuidesCSV()" filename="guides.csv" csv-header="['Seq',  'Start',   'Score', 'Gene', 'Exon']" csv-column-order="['seq', 'start', 'score', 'gene', 'exon']">
                  <span class="sidebar-primary-item-action-text">
   Export Library (.csv)
                  </span>
                </a>
              </div>
            </span>
          </li>
        </ul>
      </div>
    </div>
    <div id="page-content-wrapper">
      <div class="page-content">
        <div class="container-fluid" id='container'>
          <div class="row">
            <div class="col-md-12">
              <div class="designer-gene-title">{{ gene.name }}: <span>{{ selectedGuides(gene.name).length }} guides in library targeting {{ exonsUtilized(gene).length }} of {{ gene.exons.length }} exons</span></div>
              <guides-bar-chart></guides-bar-chart>
              <svg width="100%" x="20" height="50" ng-if="guidesReady" id="exon_graph">
                <g id="all_exons">
                  <rect class="connector" fill="#000" height="3" stroke="#000" width="100%" x="0" y="25" id="connector_rect"></rect>
              
                  <g drawindividualexon index="{{$index}}" exons-length="{{gene.exons.length}}" exon="exon" modify-svg-unit="modifySvgUnit(unit)" ng-repeat="exon in gene.exons" y="0">
                  </g>
                </g>
              </svg>
              <expression-bar-chart></expression-bar-chart>
            </div>
          </div>
          <div class="row">
            <div class=".col-md-6 .col-md-offset-3">
              <div class="table-header">
                <span class="left-table-header">
                  Customize your guide selection.
                </span>
                <span class="right-table-header">
                  Choose different guides <switch id="show_different_guides" name="show_different_guides" ng-model="show_different_guides" ng-disabled="false" class="sm"></switch>
                </span>
              </div>
              <table class="table">
                <tr>
                  <th>
                    <select-all-checkbox checkboxes="all_gRNAs[gene.name]" counter="countSelectedGuides" ng-show="show_different_guides" chartdata="chart_config.guides.data[0]" guidechange="guideSelected(guide)"></select-all-checkbox>
                  </th>
                  <th>Guide Sequence (5' <i class="fa fa-long-arrow-right"></i> 3')</th>
                  <th>PAM</th>
                  <th><a tooltip-placement="left" uib-tooltip="Efficiency scores are computed using the techniques described by (1) Doench, et al., 2014; and (2) Fusi, et al., 2016., and presented as (1)/(2)." ng-click="orderByField='score'; reverseSort = !reverseSort">On-target Efficiency </a><span ng-show="orderByField == 'score'"><span ng-show="!reverseSort"><i class="fa fa-angle-up"></i></span><span ng-show="reverseSort"><i class="fa fa-angle-down"></i></span></span></th>
                  <th><a href="" ng-click="orderByField='exon'; reverseSort = !reverseSort">Exon targeted by guide </a><span ng-show="orderByField == 'exon'"><span ng-show="!reverseSort"><i class="fa fa-angle-up"></i></span><span ng-show="reverseSort"><i class="fa fa-angle-down"></i></span></span></th>
                </tr>
                <tr ng-repeat="guide in all_gRNAs[gene.name] | orderBy:orderByField:reverseSort" ng-hide="!show_different_guides && !guide.selected">
                  <td><input ng-show="show_different_guides" type="checkbox" ng-model="guide.selected" ng-change="guideSelected(guide)"></td>
                  <td class="nt-sequence">{{ guide.seq }}</td>
                  <td class="nt-sequence">{{ guide.PAM }}</td>
                  <td>{{ guide.score.toFixed(2) }}</td>
                  <td>{{ guide.exon }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>